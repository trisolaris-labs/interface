{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar base_1 = require(\"./base\");\n\nvar Url = __importStar(require(\"url\"));\n\nfunction isRelativeUrl(url) {\n  var u = Url.parse(url);\n  return u.protocol === null && u.host === null && u.port === null;\n}\n\nfunction isSameOrigin(a, b) {\n  var ua = Url.parse(a);\n  var ub = Url.parse(b); // https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\n\n  return ua.protocol === ub.protocol && ua.hostname === ub.hostname && ua.port === ub.port;\n}\n\nvar BrowserImage =\n/** @class */\nfunction (_super) {\n  __extends(BrowserImage, _super);\n\n  function BrowserImage() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  BrowserImage.prototype._initCanvas = function () {\n    var img = this.image;\n    var canvas = this._canvas = document.createElement('canvas');\n    var context = this._context = canvas.getContext('2d');\n    canvas.className = 'vibrant-canvas';\n    canvas.style.display = 'none';\n    this._width = canvas.width = img.width;\n    this._height = canvas.height = img.height;\n    context.drawImage(img, 0, 0);\n    document.body.appendChild(canvas);\n  };\n\n  BrowserImage.prototype.load = function (image) {\n    var _this = this;\n\n    var img = null;\n    var src = null;\n\n    if (typeof image === 'string') {\n      img = document.createElement('img');\n\n      if (!isRelativeUrl(image) && !isSameOrigin(window.location.href, image)) {\n        img.crossOrigin = 'anonymous';\n      }\n\n      src = img.src = image;\n    } else if (image instanceof HTMLImageElement) {\n      img = image;\n      src = image.src;\n    } else {\n      return Promise.reject(new Error(\"Cannot load buffer as an image in browser\"));\n    }\n\n    this.image = img;\n    return new Promise(function (resolve, reject) {\n      var onImageLoad = function () {\n        _this._initCanvas();\n\n        resolve(_this);\n      };\n\n      if (img.complete) {\n        // Already loaded\n        onImageLoad();\n      } else {\n        img.onload = onImageLoad;\n\n        img.onerror = function (e) {\n          return reject(new Error(\"Fail to load image: \" + src));\n        };\n      }\n    });\n  };\n\n  BrowserImage.prototype.clear = function () {\n    this._context.clearRect(0, 0, this._width, this._height);\n  };\n\n  BrowserImage.prototype.update = function (imageData) {\n    this._context.putImageData(imageData, 0, 0);\n  };\n\n  BrowserImage.prototype.getWidth = function () {\n    return this._width;\n  };\n\n  BrowserImage.prototype.getHeight = function () {\n    return this._height;\n  };\n\n  BrowserImage.prototype.resize = function (targetWidth, targetHeight, ratio) {\n    var _a = this,\n        canvas = _a._canvas,\n        context = _a._context,\n        img = _a.image;\n\n    this._width = canvas.width = targetWidth;\n    this._height = canvas.height = targetHeight;\n    context.scale(ratio, ratio);\n    context.drawImage(img, 0, 0);\n  };\n\n  BrowserImage.prototype.getPixelCount = function () {\n    return this._width * this._height;\n  };\n\n  BrowserImage.prototype.getImageData = function () {\n    return this._context.getImageData(0, 0, this._width, this._height);\n  };\n\n  BrowserImage.prototype.remove = function () {\n    if (this._canvas && this._canvas.parentNode) {\n      this._canvas.parentNode.removeChild(this._canvas);\n    }\n  };\n\n  return BrowserImage;\n}(base_1.ImageBase);\n\nexports.default = BrowserImage;","map":{"version":3,"sources":["../../src/image/browser.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAA,MAAA,GAAA,OAAA,CAAA,QAAA,CAAA;;AACA,IAAA,GAAA,GAAA,YAAA,CAAA,OAAA,CAAA,KAAA,CAAA,CAAA;;AAEA,SAAS,aAAT,CAAwB,GAAxB,EAAmC;AACjC,MAAI,CAAC,GAAG,GAAG,CAAC,KAAJ,CAAU,GAAV,CAAR;AACA,SAAO,CAAC,CAAC,QAAF,KAAe,IAAf,IACL,CAAC,CAAC,IAAF,KAAW,IADN,IAEL,CAAC,CAAC,IAAF,KAAW,IAFb;AAGD;;AAED,SAAS,YAAT,CAAuB,CAAvB,EAAkC,CAAlC,EAA2C;AACzC,MAAI,EAAE,GAAG,GAAG,CAAC,KAAJ,CAAU,CAAV,CAAT;AACA,MAAI,EAAE,GAAG,GAAG,CAAC,KAAJ,CAAU,CAAV,CAAT,CAFyC,CAIzC;;AACA,SAAO,EAAE,CAAC,QAAH,KAAgB,EAAE,CAAC,QAAnB,IACL,EAAE,CAAC,QAAH,KAAgB,EAAE,CAAC,QADd,IAEL,EAAE,CAAC,IAAH,KAAY,EAAE,CAAC,IAFjB;AAGD;;AAED,IAAA,YAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAA0C,EAAA,SAAA,CAAA,YAAA,EAAA,MAAA,CAAA;;AAA1C,WAAA,YAAA,GAAA;;AAqFC;;AA/ES,EAAA,YAAA,CAAA,SAAA,CAAA,WAAA,GAAR,YAAA;AACE,QAAI,GAAG,GAAG,KAAK,KAAf;AACA,QAAI,MAAM,GAAG,KAAK,OAAL,GAAe,QAAQ,CAAC,aAAT,CAAuB,QAAvB,CAA5B;AACA,QAAI,OAAO,GAAG,KAAK,QAAL,GAAgB,MAAM,CAAC,UAAP,CAAkB,IAAlB,CAA9B;AAEA,IAAA,MAAM,CAAC,SAAP,GAAmB,gBAAnB;AACA,IAAA,MAAM,CAAC,KAAP,CAAa,OAAb,GAAuB,MAAvB;AAEA,SAAK,MAAL,GAAc,MAAM,CAAC,KAAP,GAAe,GAAG,CAAC,KAAjC;AACA,SAAK,OAAL,GAAe,MAAM,CAAC,MAAP,GAAgB,GAAG,CAAC,MAAnC;AAEA,IAAA,OAAQ,CAAC,SAAT,CAAmB,GAAnB,EAAwB,CAAxB,EAA2B,CAA3B;AAEA,IAAA,QAAQ,CAAC,IAAT,CAAc,WAAd,CAA0B,MAA1B;AACD,GAdO;;AAeR,EAAA,YAAA,CAAA,SAAA,CAAA,IAAA,GAAA,UAAM,KAAN,EAAwB;AAAxB,QAAA,KAAA,GAAA,IAAA;;AACE,QAAI,GAAG,GAA4B,IAAnC;AACA,QAAI,GAAG,GAAkB,IAAzB;;AACA,QAAI,OAAO,KAAP,KAAiB,QAArB,EAA+B;AAC7B,MAAA,GAAG,GAAG,QAAQ,CAAC,aAAT,CAAuB,KAAvB,CAAN;;AACA,UAAI,CAAC,aAAa,CAAC,KAAD,CAAd,IAAyB,CAAC,YAAY,CAAC,MAAM,CAAC,QAAP,CAAgB,IAAjB,EAAuB,KAAvB,CAA1C,EAAyE;AACvE,QAAA,GAAG,CAAC,WAAJ,GAAkB,WAAlB;AACD;;AACD,MAAA,GAAG,GAAG,GAAG,CAAC,GAAJ,GAAU,KAAhB;AACD,KAND,MAMO,IAAI,KAAK,YAAY,gBAArB,EAAuC;AAC5C,MAAA,GAAG,GAAG,KAAN;AACA,MAAA,GAAG,GAAG,KAAK,CAAC,GAAZ;AACD,KAHM,MAGA;AACL,aAAO,OAAO,CAAC,MAAR,CAAe,IAAI,KAAJ,CAAU,2CAAV,CAAf,CAAP;AACD;;AACD,SAAK,KAAL,GAAa,GAAb;AAEA,WAAO,IAAI,OAAJ,CAAuB,UAAC,OAAD,EAAU,MAAV,EAAgB;AAC5C,UAAI,WAAW,GAAG,YAAA;AAChB,QAAA,KAAI,CAAC,WAAL;;AACA,QAAA,OAAO,CAAC,KAAD,CAAP;AACD,OAHD;;AAKA,UAAI,GAAI,CAAC,QAAT,EAAmB;AACjB;AACA,QAAA,WAAW;AACZ,OAHD,MAGO;AACL,QAAA,GAAI,CAAC,MAAL,GAAc,WAAd;;AACA,QAAA,GAAI,CAAC,OAAL,GAAe,UAAC,CAAD,EAAE;AAAK,iBAAA,MAAM,CAAC,IAAI,KAAJ,CAAU,yBAAjB,GAAO,CAAD,CAAN;AAA+C,SAArE;AACD;AACF,KAbM,CAAP;AAcD,GA/BD;;AAgCA,EAAA,YAAA,CAAA,SAAA,CAAA,KAAA,GAAA,YAAA;AACE,SAAK,QAAL,CAAc,SAAd,CAAwB,CAAxB,EAA2B,CAA3B,EAA8B,KAAK,MAAnC,EAA2C,KAAK,OAAhD;AACD,GAFD;;AAGA,EAAA,YAAA,CAAA,SAAA,CAAA,MAAA,GAAA,UAAQ,SAAR,EAA4B;AAC1B,SAAK,QAAL,CAAc,YAAd,CAA2B,SAA3B,EAA6C,CAA7C,EAAgD,CAAhD;AACD,GAFD;;AAGA,EAAA,YAAA,CAAA,SAAA,CAAA,QAAA,GAAA,YAAA;AACE,WAAO,KAAK,MAAZ;AACD,GAFD;;AAGA,EAAA,YAAA,CAAA,SAAA,CAAA,SAAA,GAAA,YAAA;AACE,WAAO,KAAK,OAAZ;AACD,GAFD;;AAGA,EAAA,YAAA,CAAA,SAAA,CAAA,MAAA,GAAA,UAAQ,WAAR,EAA6B,YAA7B,EAAmD,KAAnD,EAAgE;AAC1D,QAAA,EAAA,GAAqD,IAArD;AAAA,QAAW,MAAM,GAAA,EAAA,CAAA,OAAjB;AAAA,QAA6B,OAAO,GAAA,EAAA,CAAA,QAApC;AAAA,QAA6C,GAAG,GAAA,EAAA,CAAA,KAAhD;;AAEJ,SAAK,MAAL,GAAc,MAAM,CAAC,KAAP,GAAe,WAA7B;AACA,SAAK,OAAL,GAAe,MAAM,CAAC,MAAP,GAAgB,YAA/B;AAEA,IAAA,OAAO,CAAC,KAAR,CAAc,KAAd,EAAqB,KAArB;AACA,IAAA,OAAO,CAAC,SAAR,CAAkB,GAAlB,EAAuB,CAAvB,EAA0B,CAA1B;AACD,GARD;;AASA,EAAA,YAAA,CAAA,SAAA,CAAA,aAAA,GAAA,YAAA;AACE,WAAO,KAAK,MAAL,GAAc,KAAK,OAA1B;AACD,GAFD;;AAGA,EAAA,YAAA,CAAA,SAAA,CAAA,YAAA,GAAA,YAAA;AACE,WAAO,KAAK,QAAL,CAAc,YAAd,CAA2B,CAA3B,EAA8B,CAA9B,EAAiC,KAAK,MAAtC,EAA8C,KAAK,OAAnD,CAAP;AACD,GAFD;;AAGA,EAAA,YAAA,CAAA,SAAA,CAAA,MAAA,GAAA,YAAA;AACE,QAAI,KAAK,OAAL,IAAgB,KAAK,OAAL,CAAa,UAAjC,EAA6C;AAC3C,WAAK,OAAL,CAAa,UAAb,CAAwB,WAAxB,CAAoC,KAAK,OAAzC;AACD;AACF,GAJD;;AAKF,SAAA,YAAA;AAAC,CArFD,CAA0C,MAAA,CAAA,SAA1C,CAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar base_1 = require(\"./base\");\nvar Url = __importStar(require(\"url\"));\nfunction isRelativeUrl(url) {\n    var u = Url.parse(url);\n    return u.protocol === null &&\n        u.host === null &&\n        u.port === null;\n}\nfunction isSameOrigin(a, b) {\n    var ua = Url.parse(a);\n    var ub = Url.parse(b);\n    // https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\n    return ua.protocol === ub.protocol &&\n        ua.hostname === ub.hostname &&\n        ua.port === ub.port;\n}\nvar BrowserImage = /** @class */ (function (_super) {\n    __extends(BrowserImage, _super);\n    function BrowserImage() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    BrowserImage.prototype._initCanvas = function () {\n        var img = this.image;\n        var canvas = this._canvas = document.createElement('canvas');\n        var context = this._context = canvas.getContext('2d');\n        canvas.className = 'vibrant-canvas';\n        canvas.style.display = 'none';\n        this._width = canvas.width = img.width;\n        this._height = canvas.height = img.height;\n        context.drawImage(img, 0, 0);\n        document.body.appendChild(canvas);\n    };\n    BrowserImage.prototype.load = function (image) {\n        var _this = this;\n        var img = null;\n        var src = null;\n        if (typeof image === 'string') {\n            img = document.createElement('img');\n            if (!isRelativeUrl(image) && !isSameOrigin(window.location.href, image)) {\n                img.crossOrigin = 'anonymous';\n            }\n            src = img.src = image;\n        }\n        else if (image instanceof HTMLImageElement) {\n            img = image;\n            src = image.src;\n        }\n        else {\n            return Promise.reject(new Error(\"Cannot load buffer as an image in browser\"));\n        }\n        this.image = img;\n        return new Promise(function (resolve, reject) {\n            var onImageLoad = function () {\n                _this._initCanvas();\n                resolve(_this);\n            };\n            if (img.complete) {\n                // Already loaded\n                onImageLoad();\n            }\n            else {\n                img.onload = onImageLoad;\n                img.onerror = function (e) { return reject(new Error(\"Fail to load image: \" + src)); };\n            }\n        });\n    };\n    BrowserImage.prototype.clear = function () {\n        this._context.clearRect(0, 0, this._width, this._height);\n    };\n    BrowserImage.prototype.update = function (imageData) {\n        this._context.putImageData(imageData, 0, 0);\n    };\n    BrowserImage.prototype.getWidth = function () {\n        return this._width;\n    };\n    BrowserImage.prototype.getHeight = function () {\n        return this._height;\n    };\n    BrowserImage.prototype.resize = function (targetWidth, targetHeight, ratio) {\n        var _a = this, canvas = _a._canvas, context = _a._context, img = _a.image;\n        this._width = canvas.width = targetWidth;\n        this._height = canvas.height = targetHeight;\n        context.scale(ratio, ratio);\n        context.drawImage(img, 0, 0);\n    };\n    BrowserImage.prototype.getPixelCount = function () {\n        return this._width * this._height;\n    };\n    BrowserImage.prototype.getImageData = function () {\n        return this._context.getImageData(0, 0, this._width, this._height);\n    };\n    BrowserImage.prototype.remove = function () {\n        if (this._canvas && this._canvas.parentNode) {\n            this._canvas.parentNode.removeChild(this._canvas);\n        }\n    };\n    return BrowserImage;\n}(base_1.ImageBase));\nexports.default = BrowserImage;\n//# sourceMappingURL=browser.js.map"]},"metadata":{},"sourceType":"script"}